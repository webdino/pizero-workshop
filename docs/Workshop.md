<h1>やってみよう! <br>micro SDカードの編集だけでできる<br> IOT環境データ収集</h1>
<!-- # やってみよう! micro SDカードの編集だけでできる IOT環境データ収集-->

#### まずは動かしてみよう 基本編

### 必要なもの

- Raspberry Pi Zero 本体とmicroSDカード(16GBぐらいの新品)
- window / mac / chromebookなどのパソコンとSDカードリーダー（パソコンに内蔵ならなくてもOK）
- 環境センサー（いまのところは[Omron2JCIE-BU01](https://www.omron.co.jp/ecb/product-info/sensor/iot-sensor/environmental-sensor)のみです）

### 前準備その１

まずはじめに、Raspberry Pi Zero を起動させるためには、OS（Rapbian Buster）がインストールされたmicroSDカードが必要です。

また環境センシングとデータ収集をおこなうためには、そこにpizero workshopプログラムをセットアップする必要があります。

次のどちらかを選んで、それらを準備しましょう。

- [セットアップ済みOS (Raspbian Buster)イメージをつかう（初心者におすすめ）]()
- [Raspbian Busterに自分でセットアップする（くわしい人向け）]()


### 前準備その２

定期的に環境センサから取得したデータは、その都度クラウドサービスにアップロードします。

ここからはその準備をしましょう。

クラウドサービスの[Machinist](https://app.machinist.iij.jp/)で[ユーザアカウントの新規登録](https://app.machinist.iij.jp/login)をします。

ユーザアカウントの登録が完了したらログインします。

ダッシュボードのページで、その画面右上のメールアドレス部分をクリックして、「アカウント設定」にアクセスしてください。

アカウント設定のページには、APIキーが表示されています。このAPIキーは、このあとmicroSDカードに書き込んで、Raspberry Pi ZeroからMachinistへデータをアップロードできるようにします。

<!--[Machinistでユーザアカウントをつくる]()か、[Ambientでユーザアカウントをつくる]()のどちらかを選び（両方でもよい）手順に沿って進めます。
-->


### microSDカードの編集

前準備はOKですか？

それではいよいよパソコンでmicroSDカードを編集していきます。やることはmicroSDカードの中にある`wifi.txt`と`config.js`の２つのファイルの編集だけです。

まず、パソコンにmicroSDカードを挿入しましょう。

ここからは windows / mac / chromebook それぞれのユーザ別に説明します。

---

##### windows
1. パソコンにsdカードを挿入します。
2. 「boot このドライブで問題がみつかりました。今すぐドライブを・・・」と右下に表示されますが構いません。
3. そしてここからが注意です。さらに、「ドライブを使うにはフォーマットする必要があります。フォーマットしますか？」とアラートがポップアップされるので、ここは必ず「キャンセル」を選択してください。
4. エクスプローラー（普段よく使うファイルやフォルダ一覧を表示するもの）の左のエリアにbootというドライブがあらわれます。そのなかに`setting`フォルダ、さらにそのなかに`wifi.txt`と`config.js`の２つのファイルがあることを確認します。
5. `wifi.txt`をクリックして選択し、さらに右クリックしてメニューから「プログラムから開く」を選択、そして「TeraPadなどのプログラムファイルの編集に適したテキストエディタを選択し、ファイルを開きます。
6. 同様に`config.js`も開きます。

##### mac
1. パソコンにsdカードを挿入します。
2. Finder（ファインダー）にbootデバイスがあらわれます。そのなかに`setting`フォルダ、さらにそのなかに`wifi.txt`と`config.js`の２つのファイルがあることを確認します。
3. `wifi.txt`をクリックして選択し、さらに右クリックして「このアプリケーションで開く」から「テキストエディット」を選択し、ファイルを開きます。
4. 同様に`config.js`も開きます。

##### chromebook

1. パソコンにsdカードを挿入する
2. ファイルのアプリを開く
3. 該当するファイルを開く
  - Text アプリが開かない場合、ファイルを選択後、右クリックのメニューから「アプリケーションで開く…」を選択し、Text で開く

---

ファイルを開いたら、２つのファイルそれぞれを以下の様に編集していきましょう。

まず`wifi.txt`です。

###### wifi.txt
```
ssid,passphrase
ssid,passphrase
ssid,passphrase
```
接続するwifiスポットのssidとパスワードをカンマで区切って書きます。
複数のwifiスポットを接続候補にしたいときは、上から一行づつ、接続優先順に書きます。
なおこのファイルは、raspberry pi zero の起動後に、正常にwifi設定が完了すると自動で内容が空っぽになります。

>`wifi.txt`の書き方に誤りがあった場合は、wifiの設定は更新されず、以前のwifiの設定のまま保持されます。そして`wifi.txt`ファイルは内容が空っぽにならずそのままです。
書き方に誤りがなく正常に読み込まれた場合は、以前のwifiの設定は一度全部クリアされ、新たなwifiの設定がなされます。そして`wifi.txt`は内容が空っぽになります。

つづいて`config.js`です。

###### config.js
```js
module.exports = {
  "NAME": "Rbt",
  "ADDRESS": "XXXXXXXXXXXX",
  "INTERVAL_MILLISEC": 60000,
  "RECORDS": ["CSV", "MACHINIST"],
  //"RECORDS": ["CSV", "AMBIENT"],
  //"RECORDS": ["CSV", "MACHINIST", "AMBIENT"],
  "MACHINIST_API_KEY": "xxxxxxxxxxxxxx",
  "MACHINIST_MULTIPLE": 1,
  "AMBIENT_CHANNEL": x,
  "AMBIENT_WRITE_KEY": "yyyyyyyyyyyyyyyy",
  "AMBIENT_MULTIPLE": 1
};
```
ファイル３行目の、`"ADDRESS":` の右の部分に、環境センサ（Omron2JCIE-BU01）のアドレス（数字と大文字アルファベット１２桁）を入力します。

またファイル８行目の、`"MACHINIST_API_KEY":` の右の部分には、さきほどの前準備その２でMachinistから取得したAPIキーを入力します。

入力ミスがないかよく確認してください。

とくに、コロン:やセミコロン:、カンマ,やピリオド.、クオート'とダブルクォート"、カッコの種類\[\]\{\}\(\)、そしてスラッシュ/の数などは注意深くみましょう。（これらの記号文字は、プログラミングではそれぞれが１文字で大きな意味をもちます。ちなみにこの`config.js`ファイルはjavascriptのプログラムファイルです。）

大丈夫でしょうか？

大丈夫ならファイルを上書き保存して、microSDカードを安全に取り外します。以下は windows/mac/chromebook それぞれでの手順です。

##### windows

1. 開いているテキストエディタで「保存（save）」します。
2. エクスプローラーで「bootドライブ」を選択し、右クリックでメニューを表示して、「取り出し」を選択します。
3. 「ハードウェアの取り出し - bootはコンピュータから安全に取り外すことが出来ます」と表示されるのを確認して、パソコンからmicroSDカードを取り外します。

##### mac

1. 開いているテキストエディットで「保存（save）」します。ここで「書類`config.js`があるボリュームは、バージョン履歴の保存には対応していません・・・」など表示されるかもしれませんが構いません。
2. Finder（ファインダー）で「boot」すぐ横の取り外しマークをクリックして、「boot」の表示が消えたら、パソコンからmicroSDカードを取り外します。

##### chromebook

1. ファイルのアプリを開く
2. デバイスの取り出しを選択する 

さあ、これで準備はOKです。

### 環境センシングとデータアップロードの開始

おまたせしました。

それでは、microSDカードをRaspberry Pi Zero本体に挿入して、電源を入れてみましょう。

Raspberry Pi Zero本体のLEDが点灯し、ときどきすばやく点滅していたら、正常に起動が始まっています。

そして待つこと１、２分。では、WEBブラウザでMachinistのメトリックを開いて、時々ページをリロードしてみましょう。

前準備その１で、セットアップ済みのOSイメージをつかってmicroSDカードを準備した場合は、さらに２、３分待ちます（初回の起動だけはパーティーション展開するので少し時間が掛かるのです）。

うまくいってますか？

もしうまくいってなさそうなら、以下のようにしてもう一度チェックしてみます。

Raspberry Pi Zero本体のLEDが点滅状態でないときに、Rapberry Pi Zeroから電源を抜きます。

そしてもう一度microSDカードをパソコンに挿入します。

- `wifi.txt`のssidとpassphraseは間違っていないか？
- `wifi.txt`に余分なスペースなどを入力したりしていないか？
- `config.js`は正しく入力できているか？
- 全角文字を含めていないか？
- 誤ってファイル名を変更していないか？
- など

<!--どうでしょう、けっこう簡単にできたでしょう？

しばらくグラフをみていてなにか気づくことはないでしょうか？
-->

では、つづいて[もっと便利につかってみよう 応用編](Workshop2ndPage.md)にいってみましょう。
